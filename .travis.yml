language: cpp
sudo: required
dist: trusty

os:
  - linux

compiler:
  - gcc
  - clang

python:
  - "2.7"
virtualenv:
  system_site_packages: true

env:
  global:
    - secure: "token"

addons:
  apt:
    sources:
      - trusty
    packages:
      - libboost-dev
      - libboost-thread-dev
      - libboost-graph-dev
      - stx-btree-dev

install:
  - sudo pip install cython

script:
  - GALA_COMMIT=93f5c2e11d7075

  - uname -a
  - g++ --version
  - clang++ --version
  - cython --version
  - autoconf --version
  - automake --version
  - python --version
  - pwd
  - ls -la

  # run all checks
  - ./bootstrap
  - ./configure --enable-debug CXXFLAGS=-std=c++11
  - make check

  # redo with gala
  - wget https://github.com/freetdi/gala/archive/${GALA_COMMIT}.tar.gz
  - mkdir gala_src
  - ( cd gala_src; tar --strip-components=1 -zxf ../${GALA_COMMIT}.tar.gz )
  - ( cd gala_src; ./configure )
  - make -C gala_src install DESTDIR=${PWD} prefix=GP
  - ./configure --enable-debug CXXFLAGS=-std=c++11 CPPFLAGS=-I${PWD}/GP/include
  - make check
  - make distcheck DISTCHECK_CONFIGURE_FLAGS=CXXFLAGS=-std=c++11
